<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flappy Mannequin Online</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            touch-action: manipulation;
        }

        #gameContainer {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 100vh;
            max-height: 700px;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #87CEEB 0%, #98D8C8 100%);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            padding: 20px;
        }

        .menu.hidden { display: none; }

        .menu h1 {
            font-size: clamp(24px, 8vw, 36px);
            color: #2c3e50;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 10px;
            text-align: center;
        }

        .menu-subtitle {
            color: #555;
            margin-bottom: 15px;
            font-size: clamp(12px, 3vw, 14px);
            text-align: center;
        }

        .menu-btn {
            width: 80%;
            max-width: 200px;
            padding: clamp(10px, 2.5vw, 12px) 25px;
            margin: 5px;
            font-size: clamp(13px, 3.5vw, 16px);
            font-weight: bold;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .menu-btn.play { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; }
        .menu-btn.online { background: linear-gradient(135deg, #e91e63, #9c27b0); color: white; }
        .menu-btn.skins { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; }
        .menu-btn.promo { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        .menu-btn.difficulty { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; }
        .menu-btn.cheats { background: linear-gradient(135deg, #ff0000, #8b0000); color: white; text-shadow: 0 0 10px #fff; }
        .menu-btn.fan { background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; }
        .menu-btn.pass { background: linear-gradient(135deg, #00d4ff, #7b2ff7); color: white; text-shadow: 0 0 5px rgba(255,255,255,0.5); }
        .menu-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .menu-btn:active { transform: scale(0.98); }

        .score-display {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.5);
            color: #ffd700;
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: clamp(12px, 3vw, 14px);
        }

        .current-skin-preview {
            width: 70px;
            height: 70px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }

        .current-skin-preview canvas { border-radius: 0; box-shadow: none; }

        .difficulty-badge {
            background: rgba(0,0,0,0.3);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            margin-bottom: 10px;
            font-size: 12px;
        }

        /* –°–∫–∏–Ω—ã */
        .skins-menu {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            z-index: 15;
            overflow-y: auto;
        }

        .skins-menu.hidden { display: none; }
        .skins-menu h2 { color: white; margin-bottom: 8px; font-size: clamp(18px, 5vw, 24px); }
        .skins-balance { color: #ffd700; font-size: clamp(14px, 4vw, 18px); margin-bottom: 15px; }

        .skins-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            max-width: 320px;
        }

        .skin-item {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .skin-item:hover { background: rgba(255,255,255,0.2); }
        .skin-item.owned { border: 2px solid #27ae60; }
        .skin-item.selected { border: 2px solid #ffd700; box-shadow: 0 0 15px rgba(255,215,0,0.5); }
        .skin-item.locked-cheat { border: 2px solid #ff0000; opacity: 0.6; }

        .skin-icon {
            width: 45px; height: 45px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .skin-info { flex: 1; color: white; min-width: 0; }
        .skin-info h3 { margin-bottom: 2px; font-size: clamp(13px, 3.5vw, 15px); }
        .skin-price { color: #ffd700; font-size: clamp(10px, 2.5vw, 12px); }
        .skin-price.cheat { color: #ff4444; }

        .skin-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: clamp(10px, 2.5vw, 12px);
            flex-shrink: 0;
        }

        .skin-btn.buy { background: #27ae60; color: white; }
        .skin-btn.select { background: #3498db; color: white; }
        .skin-btn.selected { background: #ffd700; color: #333; }
        .skin-btn.locked { background: #7f8c8d; color: white; cursor: not-allowed; }
        .skin-btn.cheat-locked { background: #ff0000; color: white; cursor: not-allowed; }
        .skin-btn:hover:not(.locked):not(.cheat-locked) { transform: scale(1.05); }

        .back-btn {
            margin-top: 15px;
            padding: 10px 35px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: clamp(14px, 4vw, 16px);
            cursor: pointer;
        }

        /* –°–ª–æ–∂–Ω–æ—Å—Ç—å */
        .difficulty-menu {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(180deg, #f39c12 0%, #e67e22 100%);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 15;
            padding: 20px;
        }

        .difficulty-menu.hidden { display: none; }
        .difficulty-menu h2 { color: white; margin-bottom: 25px; font-size: clamp(20px, 6vw, 28px); }

        .diff-btn {
            width: 80%; max-width: 220px;
            padding: 15px; margin: 8px;
            font-size: clamp(16px, 4vw, 20px);
            font-weight: bold;
            border: none; border-radius: 15px;
            cursor: pointer;
        }

        .diff-btn.easy { background: #27ae60; color: white; }
        .diff-btn.normal { background: #3498db; color: white; }
        .diff-btn.hard { background: #e74c3c; color: white; }
        .diff-btn.selected-diff { box-shadow: 0 0 0 4px white; transform: scale(1.05); }

        /* –ü—Ä–æ–º–æ–∫–æ–¥ */
        .promo-menu {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(180deg, #8e44ad 0%, #9b59b6 100%);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 15;
            padding: 20px;
        }

        .promo-menu.hidden { display: none; }
        .promo-menu h2 { color: white; margin-bottom: 25px; }

        .promo-input {
            width: 80%; max-width: 250px;
            padding: 15px;
            font-size: 18px;
            text-align: center;
            border: none; border-radius: 10px;
            margin-bottom: 15px;
        }

        .promo-submit {
            padding: 12px 35px;
            background: #27ae60;
            color: white;
            border: none; border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
        }

        .promo-message { color: white; margin-top: 15px; font-size: 14px; text-align: center; }
        .promo-message.success { color: #2ecc71; }
        .promo-message.error { color: #ffcccc; }

        /* –ß–∏—Ç—ã */
        .cheats-menu {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(180deg, #1a1a1a 0%, #8b0000 100%);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 20px;
            z-index: 15;
            overflow-y: auto;
        }

        .cheats-menu.hidden { display: none; }
        .cheats-menu h2 {
            color: #ff0000;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #ff0000;
            font-size: clamp(20px, 6vw, 28px);
        }

        .cheat-item {
            width: 90%;
            max-width: 280px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,0,0,0.2);
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 10px;
            border: 1px solid rgba(255,0,0,0.3);
        }

        .cheat-item span { color: white; font-size: 14px; }

        .cheat-toggle {
            padding: 8px 20px;
            border: none;
            border-radius: 15px;
            font-weight: bold;
            cursor: pointer;
            font-size: 12px;
        }

        .cheat-toggle.off { background: #555; color: #aaa; }
        .cheat-toggle.on { background: #00ff00; color: #000; box-shadow: 0 0 10px #00ff00; }

        .cheat-action {
            width: 90%;
            max-width: 280px;
            padding: 12px;
            margin: 5px 0;
            background: linear-gradient(135deg, #ff6600, #ff0000);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
        }

        .cheat-action:hover { transform: scale(1.02); box-shadow: 0 0 15px rgba(255,0,0,0.5); }

        .cheats-warning {
            color: #ffcc00;
            font-size: 11px;
            text-align: center;
            margin-top: 10px;
            padding: 0 10px;
        }

        /* Battle Pass */
        .pass-menu {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(180deg, #0a0a2e 0%, #1a0a3e 50%, #2a1a4e 100%);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            z-index: 15;
            overflow-y: auto;
        }

        .pass-menu.hidden { display: none; }
        .pass-menu h2 {
            color: #00d4ff;
            margin-bottom: 10px;
            font-size: clamp(20px, 6vw, 28px);
            text-shadow: 0 0 20px #00d4ff;
        }

        .pass-level-display {
            background: linear-gradient(135deg, #00d4ff, #7b2ff7);
            padding: 15px 30px;
            border-radius: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .pass-level-display .level {
            font-size: 36px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .pass-level-display .label {
            font-size: 12px;
            color: rgba(255,255,255,0.8);
        }

        .pass-progress {
            width: 90%;
            max-width: 300px;
            margin-bottom: 15px;
        }

        .pass-progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .pass-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7, #ff00ff);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .pass-progress-text {
            color: rgba(255,255,255,0.7);
            font-size: 11px;
            text-align: center;
        }

        .pass-rewards {
            width: 95%;
            max-width: 320px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .pass-reward-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.05);
            padding: 10px;
            margin: 5px 0;
            border-radius: 10px;
            border-left: 3px solid #444;
        }

        .pass-reward-item.unlocked {
            border-left-color: #00ff00;
            background: rgba(0,255,0,0.1);
        }

        .pass-reward-item.current {
            border-left-color: #00d4ff;
            background: rgba(0,212,255,0.2);
            box-shadow: 0 0 10px rgba(0,212,255,0.3);
        }

        .pass-reward-item.exclusive {
            border-left-color: #ff00ff;
            background: linear-gradient(135deg, rgba(255,0,255,0.2), rgba(123,47,247,0.2));
        }

        .pass-reward-level {
            width: 35px;
            height: 35px;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .pass-reward-item.unlocked .pass-reward-level {
            background: #00ff00;
            color: #000;
        }

        .pass-reward-info {
            flex: 1;
            color: white;
        }

        .pass-reward-info h4 {
            font-size: 13px;
            margin-bottom: 2px;
        }

        .pass-reward-info p {
            font-size: 10px;
            color: rgba(255,255,255,0.6);
        }

        .pass-reward-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Fan Skins */
        .fan-menu {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(180deg, #ff6b35 0%, #f7931e 50%, #ffcc00 100%);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            z-index: 15;
            overflow-y: auto;
        }

        .fan-menu.hidden { display: none; }
        .fan-menu h2 {
            color: white;
            margin-bottom: 5px;
            font-size: clamp(18px, 5vw, 24px);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .fan-menu .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 11px;
            margin-bottom: 10px;
        }

        .fan-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .fan-tab {
            padding: 8px 15px;
            background: rgba(0,0,0,0.2);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .fan-tab.active {
            background: rgba(255,255,255,0.3);
            font-weight: bold;
        }

        .fan-skins-grid {
            width: 100%;
            max-width: 320px;
            max-height: 280px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 10px;
        }

        .fan-skin-card {
            background: rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fan-skin-card.winner {
            background: linear-gradient(135deg, rgba(255,215,0,0.4), rgba(255,165,0,0.4));
            border: 2px solid #ffd700;
        }

        .fan-skin-preview {
            width: 50px;
            height: 50px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fan-skin-info {
            flex: 1;
            color: white;
        }

        .fan-skin-info h4 {
            font-size: 13px;
            margin-bottom: 2px;
        }

        .fan-skin-info .author {
            font-size: 10px;
            color: rgba(255,255,255,0.7);
        }

        .fan-skin-votes {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }

        .vote-count {
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .vote-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .vote-btn:hover {
            background: rgba(255,255,255,0.4);
            transform: scale(1.1);
        }

        .vote-btn.voted {
            background: #4CAF50;
        }

        .submit-skin-btn {
            width: 100%;
            max-width: 280px;
            padding: 12px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .submit-skin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        /* Drawing Modal */
        .draw-modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 20px;
        }

        .draw-modal.hidden { display: none; }

        .draw-modal h3 {
            color: white;
            margin-bottom: 10px;
        }

        .draw-canvas-container {
            background: white;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
        }

        #drawCanvas {
            border: 2px solid #333;
            border-radius: 5px;
            cursor: crosshair;
            touch-action: none;
        }

        .draw-tools {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .color-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid white;
            cursor: pointer;
        }

        .color-btn.active {
            box-shadow: 0 0 10px white;
            transform: scale(1.2);
        }

        .draw-actions {
            display: flex;
            gap: 10px;
        }

        .draw-action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            font-weight: bold;
        }

        .draw-action-btn.submit { background: #4CAF50; color: white; }
        .draw-action-btn.clear { background: #ff9800; color: white; }
        .draw-action-btn.cancel { background: #f44336; color: white; }

        .skin-name-input {
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            width: 200px;
            text-align: center;
            margin-bottom: 10px;
        }

        /* Online Parkour */
        .online-menu {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(180deg, #e91e63 0%, #9c27b0 100%);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            z-index: 15;
        }

        .online-menu.hidden { display: none; }
        .online-menu h2 { color: white; margin-bottom: 10px; font-size: clamp(18px, 5vw, 24px); }

        .online-stats {
            background: rgba(0,0,0,0.3);
            padding: 8px 15px;
            border-radius: 10px;
            color: white;
            margin-bottom: 10px;
            font-size: 12px;
        }

        .online-stats span { color: #ffd700; font-weight: bold; }

        .leaderboard {
            width: 100%;
            max-width: 300px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .leaderboard h3 { color: #ffd700; font-size: 14px; margin-bottom: 8px; text-align: center; }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            margin-bottom: 4px;
            color: white;
            font-size: 12px;
        }

        .leaderboard-item.me { background: rgba(255,215,0,0.3); }

        /* –ß–∞—Ç */
        .chat-container {
            width: 100%;
            max-width: 300px;
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .chat-messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            max-height: 180px;
        }

        .chat-msg {
            margin-bottom: 6px;
            padding: 5px 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            font-size: 11px;
        }

        .chat-msg .name { color: #ffd700; font-weight: bold; }
        .chat-msg .text { color: white; }
        .chat-msg.system { background: rgba(255,0,0,0.2); color: #ffaaaa; font-style: italic; }

        .chat-input-row {
            display: flex;
            padding: 8px;
            gap: 5px;
            background: rgba(0,0,0,0.2);
        }

        .chat-input {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 15px;
            font-size: 12px;
        }

        .chat-send {
            padding: 8px 15px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
        }

        .name-input-row {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .name-input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
        }

        .name-btn {
            padding: 10px 15px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        /* Game Over */
        .game-over {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
            padding: 20px;
        }

        .game-over.hidden { display: none; }
        .game-over h2 { color: #e74c3c; font-size: clamp(32px, 10vw, 48px); margin-bottom: 15px; }
        .game-over .final-score { color: white; font-size: 20px; margin-bottom: 8px; }
        .game-over .best-score { color: #ffd700; font-size: 16px; margin-bottom: 20px; }
        .game-over .earned { color: #2ecc71; font-size: 14px; margin-bottom: 20px; }

        .jump-zone {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 5;
            cursor: pointer;
        }

        @media (max-width: 450px) {
            #gameContainer { max-height: 100vh; border-radius: 0; }
            canvas, .menu, .skins-menu, .promo-menu, .game-over, .difficulty-menu, .online-menu, .cheats-menu { border-radius: 0; }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="400" height="700"></canvas>
        <div class="jump-zone" id="jumpZone"></div>

        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="mainMenu" class="menu">
            <canvas id="menuSkinPreview" width="50" height="50" class="current-skin-preview"></canvas>
            <h1>Flappy Mannequin</h1>
            <div class="difficulty-badge" id="currentDiffBadge">–ù–æ—Ä–º–∞–ª—å–Ω–æ</div>
            <p class="menu-subtitle">–¢–∞–ø–Ω–∏ –∏–ª–∏ –ü–†–û–ë–ï–õ</p>
            <div class="score-display">–û—á–∫–∏: <span id="totalScore">0</span></div>
            <button class="menu-btn play" onclick="startGame()">–ò–≥—Ä–∞—Ç—å</button>
            <button class="menu-btn online" onclick="openOnline()">–û–Ω–ª–∞–π–Ω –ü–∞—Ä–∫—É—Ä</button>
            <button class="menu-btn skins" onclick="openSkins()">–°–∫–∏–Ω—ã</button>
            <button class="menu-btn difficulty" onclick="openDifficulty()">–°–ª–æ–∂–Ω–æ—Å—Ç—å</button>
            <button class="menu-btn promo" onclick="openPromo()">–ü—Ä–æ–º–æ–∫–æ–¥</button>
            <button class="menu-btn pass" onclick="openPass()">–ü–∞—Å—Å</button>
            <button class="menu-btn fan" onclick="openFanSkins()">–°–∫–∏–Ω—ã –æ—Ç —Ñ–∞–Ω–∞—Ç–æ–≤</button>
            <button class="menu-btn cheats" onclick="openCheats()">–ß–∏—Ç—ã</button>
        </div>

        <!-- –û–Ω–ª–∞–π–Ω –ü–∞—Ä–∫—É—Ä -->
        <div id="onlineMenu" class="online-menu hidden">
            <h2>–û–Ω–ª–∞–π–Ω –ü–∞—Ä–∫—É—Ä</h2>
            <div class="online-stats">–ò–≥—Ä–æ–∫–æ–≤ –æ–Ω–ª–∞–π–Ω: <span id="onlineCount">0</span></div>

            <div class="name-input-row" id="nameInputRow">
                <input type="text" id="playerNameInput" class="name-input" placeholder="–¢–≤–æ–π –Ω–∏–∫..." maxlength="15">
                <button class="name-btn" onclick="setPlayerName()">OK</button>
            </div>

            <div class="leaderboard">
                <h3>–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h3>
                <div id="leaderboardList"></div>
            </div>

            <div class="chat-container">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input-row">
                    <input type="text" id="chatInput" class="chat-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." maxlength="100">
                    <button class="chat-send" onclick="sendChatMessage()">–û—Ç–ø—Ä</button>
                </div>
            </div>

            <button class="menu-btn play" onclick="startOnlineGame()">–ò–≥—Ä–∞—Ç—å –æ–Ω–ª–∞–π–Ω</button>
            <button class="back-btn" onclick="closeOnline()">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- –°–ª–æ–∂–Ω–æ—Å—Ç—å -->
        <div id="difficultyMenu" class="difficulty-menu hidden">
            <h2>–°–ª–æ–∂–Ω–æ—Å—Ç—å</h2>
            <button class="diff-btn easy" onclick="setDifficulty('easy')">–õ–µ–≥–∫–æ</button>
            <button class="diff-btn normal" onclick="setDifficulty('normal')">–ù–æ—Ä–º–∞–ª—å–Ω–æ</button>
            <button class="diff-btn hard" onclick="setDifficulty('hard')">–°–ª–æ–∂–Ω–æ</button>
            <button class="back-btn" onclick="closeDifficulty()">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- –°–∫–∏–Ω—ã -->
        <div id="skinsMenu" class="skins-menu hidden">
            <h2>–ú–∞–≥–∞–∑–∏–Ω –°–∫–∏–Ω–æ–≤</h2>
            <div class="skins-balance">–û—á–∫–∏: <span id="skinsBalance">0</span></div>
            <div class="skins-grid" id="skinsGrid"></div>
            <button class="back-btn" onclick="closeSkins()">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- –ü—Ä–æ–º–æ–∫–æ–¥ -->
        <div id="promoMenu" class="promo-menu hidden">
            <h2>–ü—Ä–æ–º–æ–∫–æ–¥</h2>
            <input type="text" id="promoInput" class="promo-input" placeholder="–ö–æ–¥...">
            <button class="promo-submit" onclick="submitPromo()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="back-btn" onclick="closePromo()">–ù–∞–∑–∞–¥</button>
            <p id="promoMessage" class="promo-message"></p>
        </div>

        <!-- –ß–∏—Ç—ã -->
        <div id="cheatsMenu" class="cheats-menu hidden">
            <h2>–ß–ò–¢–´</h2>

            <div class="cheat-item">
                <span>–ë–µ—Å—Å–º–µ—Ä—Ç–∏–µ</span>
                <button id="godModeBtn" class="cheat-toggle off" onclick="toggleCheat('godMode')">OFF</button>
            </div>

            <div class="cheat-item">
                <span>–ê–≤—Ç–æ-–ø—Ä—ã–∂–æ–∫</span>
                <button id="autoJumpBtn" class="cheat-toggle off" onclick="toggleCheat('autoJump')">OFF</button>
            </div>

            <div class="cheat-item">
                <span>–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ</span>
                <button id="slowMoBtn" class="cheat-toggle off" onclick="toggleCheat('slowMo')">OFF</button>
            </div>

            <div class="cheat-item">
                <span>–ú–µ–≥–∞-–ø—Ä—ã–∂–æ–∫</span>
                <button id="megaJumpBtn" class="cheat-toggle off" onclick="toggleCheat('megaJump')">OFF</button>
            </div>

            <div class="cheat-item">
                <span>–®–∏—Ä–æ–∫–∏–π –ø—Ä–æ—Ö–æ–¥</span>
                <button id="wideGapBtn" class="cheat-toggle off" onclick="toggleCheat('wideGap')">OFF</button>
            </div>

            <div class="cheat-item">
                <span>–ù–µ–≤–∏–¥–∏–º—ã–µ —Ç—Ä—É–±—ã</span>
                <button id="invisPipesBtn" class="cheat-toggle off" onclick="toggleCheat('invisPipes')">OFF</button>
            </div>

            <div class="cheat-item">
                <span>–ú–∏–Ω–∏-—Ä–∞–∑–º–µ—Ä</span>
                <button id="miniSizeBtn" class="cheat-toggle off" onclick="toggleCheat('miniSize')">OFF</button>
            </div>

            <div class="cheat-item">
                <span>–ó–∞–º–æ—Ä–æ–∑–∫–∞ —Ç—Ä—É–±</span>
                <button id="freezePipesBtn" class="cheat-toggle off" onclick="toggleCheat('freezePipes')">OFF</button>
            </div>

            <div class="cheat-item">
                <span>–ü–æ–ª—ë—Ç</span>
                <button id="flyModeBtn" class="cheat-toggle off" onclick="toggleCheat('flyMode')">OFF</button>
            </div>

            <div class="cheat-item">
                <span>–û—á–∫–∏ x2</span>
                <button id="doubleScoreBtn" class="cheat-toggle off" onclick="toggleCheat('doubleScore')">OFF</button>
            </div>

            <div class="cheat-item">
                <span>–†–∞–¥—É–∂–Ω—ã–π —Ä–µ–∂–∏–º</span>
                <button id="rainbowModeBtn" class="cheat-toggle off" onclick="toggleCheat('rainbowMode')">OFF</button>
            </div>

            <div class="cheat-item">
                <span>–ù–µ—Ç —Ç—Ä—É–±</span>
                <button id="noPipesBtn" class="cheat-toggle off" onclick="toggleCheat('noPipes')">OFF</button>
            </div>

            <button class="cheat-action" onclick="cheatDisableAll()" style="background: linear-gradient(135deg, #333, #000); border: 2px solid #ff0000;">–í–´–ö–õ–Æ–ß–ò–¢–¨ –í–°–ï –ß–ò–¢–´</button>
            <button class="cheat-action" onclick="cheatEnableAll()" style="background: linear-gradient(135deg, #00ff00, #008800);">–í–ö–õ–Æ–ß–ò–¢–¨ –í–°–ï –ß–ò–¢–´</button>

            <button class="cheat-action" onclick="cheatAddCoins()">+1000 –æ—á–∫–æ–≤</button>
            <button class="cheat-action" onclick="cheatAdd10k()">+10000 –æ—á–∫–æ–≤</button>
            <button class="cheat-action" onclick="cheatMaxScore()">–†–µ–∫–æ—Ä–¥ 9999</button>
            <button class="cheat-action" onclick="cheatUnlockAll()">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –í–°–ï —Å–∫–∏–Ω—ã</button>
            <button class="cheat-action" onclick="cheatResetProgress()">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>

            <p class="cheats-warning">–ß–∏—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ –æ–¥–∏–Ω–æ—á–Ω–æ–π –∏–≥—Ä–µ</p>

            <button class="back-btn" onclick="closeCheats()">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- Battle Pass -->
        <div id="passMenu" class="pass-menu hidden">
            <h2>BATTLE PASS</h2>

            <div class="pass-level-display">
                <div class="level" id="passLevel">1</div>
                <div class="label">–£–†–û–í–ï–ù–¨</div>
            </div>

            <div class="pass-progress">
                <div class="pass-progress-bar">
                    <div class="pass-progress-fill" id="passProgressFill" style="width: 0%"></div>
                </div>
                <div class="pass-progress-text" id="passProgressText">0 / 10 –æ—á–∫–æ–≤ –¥–æ —Å–ª–µ–¥. —É—Ä–æ–≤–Ω—è</div>
            </div>

            <div class="pass-rewards" id="passRewards"></div>

            <button class="back-btn" onclick="closePass()">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- Fan Skins -->
        <div id="fanMenu" class="fan-menu hidden">
            <h2>–°–∫–∏–Ω—ã –æ—Ç —Ñ–∞–Ω–∞—Ç–æ–≤</h2>
            <p class="subtitle">–ì–æ–ª–æ—Å—É–π –∑–∞ –ª—É—á—à–∏–µ —Å–∫–∏–Ω—ã!</p>

            <div class="fan-tabs">
                <button class="fan-tab active" onclick="switchFanTab('vote', this)">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</button>
                <button class="fan-tab" onclick="switchFanTab('winners', this)">–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏</button>
            </div>

            <div class="fan-skins-grid" id="fanSkinsGrid">
                <!-- –°–∫–∏–Ω—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <button class="submit-skin-btn" onclick="openDrawModal()">‚úèÔ∏è –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Å–≤–æ–π —Å–∫–∏–Ω</button>
            <button class="submit-skin-btn" onclick="openImportModal()" style="background: linear-gradient(135deg, #2196F3, #1976D2);">üì• –î–æ–±–∞–≤–∏—Ç—å —Å–∫–∏–Ω –¥—Ä—É–≥–∞</button>

            <button class="back-btn" onclick="closeFanSkins()">–ù–∞–∑–∞–¥</button>
        </div>

        <!-- Import Skin Modal -->
        <div id="importModal" class="draw-modal hidden">
            <h3>–î–æ–±–∞–≤–∏—Ç—å —Å–∫–∏–Ω –¥—Ä—É–≥–∞</h3>
            <p style="color: #aaa; font-size: 12px; margin-bottom: 15px;">–í—Å—Ç–∞–≤—å –∫–æ–¥ —Å–∫–∏–Ω–∞ –æ—Ç –¥—Ä—É–≥–∞:</p>
            <textarea id="importCodeInput" style="width: 280px; height: 80px; border-radius: 10px; padding: 10px; font-size: 12px; resize: none;" placeholder="–í—Å—Ç–∞–≤—å –∫–æ–¥ —Å—é–¥–∞..."></textarea>
            <div class="draw-actions" style="margin-top: 15px;">
                <button class="draw-action-btn submit" onclick="importFanSkin()">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="draw-action-btn cancel" onclick="closeImportModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>

        <!-- Game Over -->
        <div id="gameOver" class="game-over hidden">
            <h2>GAME OVER</h2>
            <p class="final-score">–°—á—ë—Ç: <span id="finalScore">0</span></p>
            <p class="best-score">–õ—É—á—à–∏–π: <span id="bestScore">0</span></p>
            <p class="earned">+<span id="earnedPoints">0</span> –æ—á–∫–æ–≤!</p>
            <button class="menu-btn play" onclick="startGame()">–ï—â—ë —Ä–∞–∑</button>
            <button class="back-btn" onclick="showMainMenu()">–í –º–µ–Ω—é</button>
        </div>
    </div>

    <!-- Drawing Modal (—Å–Ω–∞—Ä—É–∂–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è) -->
    <div id="drawModal" class="draw-modal hidden">
        <h3>–ù–∞—Ä–∏—Å—É–π —Å–≤–æ–π —Å–∫–∏–Ω!</h3>

        <input type="text" id="skinNameInput" class="skin-name-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫–∏–Ω–∞..." maxlength="20">

        <div class="draw-canvas-container">
            <canvas id="drawCanvas" width="80" height="80"></canvas>
        </div>

        <div class="draw-tools">
            <button class="color-btn active" style="background: #000000" onclick="setDrawColor('#000000', this)"></button>
            <button class="color-btn" style="background: #ffffff" onclick="setDrawColor('#ffffff', this)"></button>
            <button class="color-btn" style="background: #ff0000" onclick="setDrawColor('#ff0000', this)"></button>
            <button class="color-btn" style="background: #00ff00" onclick="setDrawColor('#00ff00', this)"></button>
            <button class="color-btn" style="background: #0000ff" onclick="setDrawColor('#0000ff', this)"></button>
            <button class="color-btn" style="background: #ffff00" onclick="setDrawColor('#ffff00', this)"></button>
            <button class="color-btn" style="background: #ff00ff" onclick="setDrawColor('#ff00ff', this)"></button>
            <button class="color-btn" style="background: #00ffff" onclick="setDrawColor('#00ffff', this)"></button>
            <button class="color-btn" style="background: #ff9900" onclick="setDrawColor('#ff9900', this)"></button>
            <button class="color-btn" style="background: #9900ff" onclick="setDrawColor('#9900ff', this)"></button>
        </div>

        <div class="draw-actions">
            <button class="draw-action-btn clear" onclick="clearDrawCanvas()">–û—á–∏—Å—Ç–∏—Ç—å</button>
            <button class="draw-action-btn submit" onclick="submitFanSkin()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <button class="draw-action-btn cancel" onclick="closeDrawModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        // Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const firebaseConfig = {
            apiKey: "AIzaSyDemo-FlappyMannequin",
            authDomain: "flappy-mannequin.firebaseapp.com",
            databaseURL: "https://flappy-mannequin-default-rtdb.firebaseio.com",
            projectId: "flappy-mannequin",
            storageBucket: "flappy-mannequin.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abc123"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        let db = null;
        let playerId = 'player_' + Math.random().toString(36).substr(2, 9);
        let playerName = localStorage.getItem('flappyPlayerName') || '';
        let isOnlineMode = false;

        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        } catch (e) {
            console.log('Firebase offline mode');
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // –§—É–Ω–∫—Ü–∏–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å–∫–∏–Ω–æ–≤
        function drawMannequin(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);
            ctx.fillStyle = '#DEB887';
            ctx.beginPath();
            ctx.arc(20*s, 8*s, 8*s, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#8B7355';
            ctx.fillRect(15*s, 16*s, 10*s, 14*s);
            ctx.fillRect(8*s, 18*s, 7*s, 3*s);
            ctx.fillRect(25*s, 18*s, 7*s, 3*s);
            ctx.fillRect(15*s, 30*s, 4*s, 10*s);
            ctx.fillRect(21*s, 30*s, 4*s, 10*s);
            ctx.restore();
        }

        function drawKnife(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);
            ctx.fillStyle = '#C0C0C0';
            ctx.beginPath();
            ctx.moveTo(5*s, 20*s);
            ctx.lineTo(30*s, 15*s);
            ctx.lineTo(35*s, 20*s);
            ctx.lineTo(30*s, 25*s);
            ctx.closePath();
            ctx.fill();
            ctx.fillStyle = '#E8E8E8';
            ctx.beginPath();
            ctx.moveTo(10*s, 19*s);
            ctx.lineTo(25*s, 16*s);
            ctx.lineTo(25*s, 18*s);
            ctx.lineTo(10*s, 21*s);
            ctx.closePath();
            ctx.fill();
            ctx.fillStyle = '#4A3728';
            ctx.fillRect(0*s, 17*s, 8*s, 6*s);
            ctx.restore();
        }

        function drawSonic(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);
            ctx.fillStyle = '#1E90FF';
            ctx.beginPath();
            ctx.moveTo(25*s, 0*s); ctx.lineTo(35*s, 8*s); ctx.lineTo(22*s, 10*s);
            ctx.closePath();
            ctx.fill();
            ctx.beginPath();
            ctx.moveTo(30*s, 5*s); ctx.lineTo(40*s, 10*s); ctx.lineTo(28*s, 14*s);
            ctx.closePath();
            ctx.fill();
            ctx.beginPath();
            ctx.arc(18*s, 14*s, 12*s, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#FFDAB9';
            ctx.beginPath();
            ctx.arc(12*s, 16*s, 7*s, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.ellipse(10*s, 14*s, 3*s, 4*s, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(11*s, 14*s, 1.5*s, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(6*s, 17*s, 2*s, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#1E90FF';
            ctx.beginPath();
            ctx.ellipse(18*s, 30*s, 8*s, 7*s, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }

        function drawAmongUs(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);
            ctx.fillStyle = '#C51111';
            ctx.beginPath();
            ctx.moveTo(8*s, 10*s);
            ctx.quadraticCurveTo(8*s, 2*s, 20*s, 2*s);
            ctx.quadraticCurveTo(32*s, 2*s, 32*s, 10*s);
            ctx.lineTo(32*s, 28*s);
            ctx.lineTo(26*s, 28*s); ctx.lineTo(26*s, 36*s);
            ctx.lineTo(20*s, 36*s); ctx.lineTo(20*s, 28*s);
            ctx.lineTo(14*s, 28*s); ctx.lineTo(14*s, 36*s);
            ctx.lineTo(8*s, 36*s); ctx.lineTo(8*s, 10*s);
            ctx.closePath();
            ctx.fill();
            ctx.beginPath();
            ctx.moveTo(32*s, 12*s);
            ctx.quadraticCurveTo(40*s, 12*s, 40*s, 20*s);
            ctx.quadraticCurveTo(40*s, 28*s, 32*s, 28*s);
            ctx.lineTo(32*s, 12*s);
            ctx.closePath();
            ctx.fill();
            ctx.fillStyle = '#89CFF0';
            ctx.beginPath();
            ctx.moveTo(6*s, 8*s);
            ctx.quadraticCurveTo(6*s, 4*s, 14*s, 6*s);
            ctx.lineTo(22*s, 10*s);
            ctx.quadraticCurveTo(24*s, 18*s, 14*s, 20*s);
            ctx.quadraticCurveTo(6*s, 18*s, 6*s, 8*s);
            ctx.closePath();
            ctx.fill();
            ctx.strokeStyle = '#1a1a1a';
            ctx.lineWidth = 2*s;
            ctx.stroke();
            ctx.restore();
        }

        function draw67(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);
            ctx.font = `bold ${28*s}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.strokeStyle = '#0a2351';
            ctx.lineWidth = 3*s;
            ctx.strokeText('67', 20*s, 22*s);
            ctx.fillStyle = '#4682B4';
            ctx.fillText('67', 20*s, 22*s);
            ctx.restore();
        }

        // –ß—ë—Ä–Ω—ã–µ —Å—Ç–∏–∫–º–µ–Ω—ã (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
        function drawBlackStick1(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);
            ctx.fillStyle = '#111';
            ctx.beginPath();
            ctx.arc(20*s, 6*s, 6*s, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#111';
            ctx.lineWidth = 3*s;
            ctx.beginPath();
            ctx.moveTo(20*s, 12*s); ctx.lineTo(20*s, 26*s);
            ctx.moveTo(20*s, 16*s); ctx.lineTo(10*s, 22*s);
            ctx.moveTo(20*s, 16*s); ctx.lineTo(30*s, 22*s);
            ctx.moveTo(20*s, 26*s); ctx.lineTo(12*s, 38*s);
            ctx.moveTo(20*s, 26*s); ctx.lineTo(28*s, 38*s);
            ctx.stroke();
            ctx.restore();
        }

        function drawBlackStick2(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);
            ctx.fillStyle = '#222';
            ctx.beginPath();
            ctx.arc(20*s, 6*s, 6*s, 0, Math.PI * 2);
            ctx.fill();
            // –ì–ª–∞–∑–∞ –∫—Ä–∞—Å–Ω—ã–µ
            ctx.fillStyle = '#ff0000';
            ctx.beginPath();
            ctx.arc(17*s, 5*s, 1.5*s, 0, Math.PI * 2);
            ctx.arc(23*s, 5*s, 1.5*s, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 3*s;
            ctx.beginPath();
            ctx.moveTo(20*s, 12*s); ctx.lineTo(20*s, 26*s);
            ctx.moveTo(20*s, 16*s); ctx.lineTo(8*s, 20*s);
            ctx.moveTo(20*s, 16*s); ctx.lineTo(32*s, 20*s);
            ctx.moveTo(20*s, 26*s); ctx.lineTo(10*s, 38*s);
            ctx.moveTo(20*s, 26*s); ctx.lineTo(30*s, 38*s);
            ctx.stroke();
            ctx.restore();
        }

        function drawBlackStick3(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);
            // –° –æ–≥–Ω—ë–º
            ctx.fillStyle = '#ff4400';
            ctx.beginPath();
            ctx.moveTo(20*s, 0); ctx.lineTo(25*s, 8*s); ctx.lineTo(22*s, 5*s);
            ctx.lineTo(28*s, 10*s); ctx.lineTo(20*s, 6*s);
            ctx.lineTo(12*s, 10*s); ctx.lineTo(18*s, 5*s);
            ctx.lineTo(15*s, 8*s);
            ctx.closePath();
            ctx.fill();
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(20*s, 10*s, 6*s, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 4*s;
            ctx.beginPath();
            ctx.moveTo(20*s, 16*s); ctx.lineTo(20*s, 28*s);
            ctx.moveTo(20*s, 20*s); ctx.lineTo(8*s, 24*s);
            ctx.moveTo(20*s, 20*s); ctx.lineTo(32*s, 24*s);
            ctx.moveTo(20*s, 28*s); ctx.lineTo(10*s, 40*s);
            ctx.moveTo(20*s, 28*s); ctx.lineTo(30*s, 40*s);
            ctx.stroke();
            ctx.restore();
        }

        // –ê–¥–º–∏–Ω—Å–∫–∏–µ —Å–∫–∏–Ω—ã (–ø—Ä–æ–º–æ–∫–æ–¥ –∞–¥–º–∏–Ω4444)
        function drawPavel(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);
            // –ì–æ–ª–æ–≤–∞ —Å –∫–∞–ø—é—à–æ–Ω–æ–º
            ctx.fillStyle = '#3d5c3d';
            ctx.beginPath();
            ctx.arc(20*s, 8*s, 9*s, 0, Math.PI * 2);
            ctx.fill();
            // –õ–∏—Ü–æ
            ctx.fillStyle = '#e8d4b8';
            ctx.beginPath();
            ctx.arc(20*s, 10*s, 6*s, 0, Math.PI * 2);
            ctx.fill();
            // –ì–ª–∞–∑–∞ –∏ —Ä–æ—Ç
            ctx.fillStyle = '#333';
            ctx.fillRect(17*s, 8*s, 2*s, 2*s);
            ctx.fillRect(22*s, 8*s, 2*s, 2*s);
            ctx.beginPath();
            ctx.arc(20*s, 13*s, 2*s, 0, Math.PI);
            ctx.stroke();
            // –ê–Ω—Ç–µ–Ω–Ω–∞ –Ω–∞ –∫–∞–ø—é—à–æ–Ω–µ
            ctx.fillStyle = '#8fbc8f';
            ctx.fillRect(19*s, 0, 2*s, 5*s);
            // –¢–µ–ª–æ —á–µ—Ä–Ω–æ–µ
            ctx.fillStyle = '#2a2a2a';
            ctx.fillRect(12*s, 17*s, 16*s, 12*s);
            // –ö—Ä–∞—Å–Ω—ã–π —É–∑–æ—Ä –Ω–∞ –≥—Ä—É–¥–∏
            ctx.fillStyle = '#c41e3a';
            ctx.beginPath();
            ctx.moveTo(20*s, 19*s);
            ctx.lineTo(26*s, 25*s);
            ctx.lineTo(20*s, 28*s);
            ctx.lineTo(14*s, 25*s);
            ctx.closePath();
            ctx.fill();
            ctx.fillStyle = '#ffd700';
            ctx.beginPath();
            ctx.arc(20*s, 24*s, 2*s, 0, Math.PI * 2);
            ctx.fill();
            // –ù–æ–≥–∏ —Å–µ—Ä—ã–µ
            ctx.fillStyle = '#666';
            ctx.fillRect(14*s, 29*s, 5*s, 11*s);
            ctx.fillRect(21*s, 29*s, 5*s, 11*s);
            ctx.restore();
        }

        function drawDaniel(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);
            // –ö–µ–ø–∫–∞
            ctx.fillStyle = '#5c3317';
            ctx.fillRect(14*s, 2*s, 12*s, 4*s);
            ctx.fillRect(12*s, 5*s, 16*s, 2*s);
            // –ñ–µ–ª—Ç–∞—è –≥–æ–ª–æ–≤–∞ —Å–º–∞–π–ª–∏–∫
            ctx.fillStyle = '#ffff00';
            ctx.fillRect(14*s, 6*s, 12*s, 10*s);
            // –ì–ª–∞–∑–∞ —Å–º–∞–π–ª–∏–∫–∞
            ctx.fillStyle = '#000';
            ctx.fillRect(16*s, 9*s, 2*s, 3*s);
            ctx.fillRect(22*s, 9*s, 2*s, 3*s);
            // –£–ª—ã–±–∫–∞
            ctx.beginPath();
            ctx.arc(20*s, 13*s, 3*s, 0.1, Math.PI - 0.1);
            ctx.stroke();
            // –ö—Ä–æ–ª–∏–∫ –Ω–∞ –ø–ª–µ—á–µ
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(30*s, 8*s, 4*s, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillRect(28*s, 2*s, 2*s, 5*s);
            ctx.fillRect(31*s, 2*s, 2*s, 5*s);
            // –¢–µ–ª–æ —á–µ—Ä–Ω–æ–µ —Å –º–∞—Ä—à–º–µ–ª–ª–æ—É
            ctx.fillStyle = '#111';
            ctx.fillRect(12*s, 16*s, 16*s, 12*s);
            // –†–∞–¥—É–∂–Ω–∞—è –º–∞—Å–∫–∞ –º–∞—Ä—à–º–µ–ª–ª–æ—É
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(20*s, 22*s, 5*s, 0, Math.PI * 2);
            ctx.fill();
            // X –≥–ª–∞–∑–∞ –º–∞—Ä—à–º–µ–ª–ª–æ—É
            ctx.strokeStyle = '#00ff00';
            ctx.lineWidth = 1.5*s;
            ctx.beginPath();
            ctx.moveTo(17*s, 20*s); ctx.lineTo(19*s, 22*s);
            ctx.moveTo(19*s, 20*s); ctx.lineTo(17*s, 22*s);
            ctx.moveTo(21*s, 20*s); ctx.lineTo(23*s, 22*s);
            ctx.moveTo(23*s, 20*s); ctx.lineTo(21*s, 22*s);
            ctx.stroke();
            // –£–ª—ã–±–∫–∞ —Ä–∞–¥—É–∂–Ω–∞—è
            ctx.strokeStyle = '#ff00ff';
            ctx.beginPath();
            ctx.arc(20*s, 24*s, 2*s, 0, Math.PI);
            ctx.stroke();
            // –†—É–∫–∞–≤–∞ —Ç–∏–≥—Ä–æ–≤—ã–µ
            ctx.fillStyle = '#ff8c00';
            ctx.fillRect(6*s, 17*s, 6*s, 8*s);
            ctx.fillRect(28*s, 17*s, 6*s, 8*s);
            ctx.fillStyle = '#000';
            ctx.fillRect(7*s, 18*s, 2*s, 2*s);
            ctx.fillRect(10*s, 21*s, 2*s, 2*s);
            ctx.fillRect(29*s, 19*s, 2*s, 2*s);
            ctx.fillRect(32*s, 22*s, 2*s, 2*s);
            // –ù–æ–≥–∏
            ctx.fillStyle = '#111';
            ctx.fillRect(14*s, 28*s, 5*s, 12*s);
            ctx.fillRect(21*s, 28*s, 5*s, 12*s);
            ctx.restore();
        }

        function drawTeo(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);
            // –ö–µ–ø–∫–∞
            ctx.fillStyle = '#8b0000';
            ctx.fillRect(14*s, 2*s, 12*s, 4*s);
            ctx.fillRect(12*s, 5*s, 16*s, 2*s);
            // –ë–µ–ª–∞—è –≥–æ–ª–æ–≤–∞
            ctx.fillStyle = '#fff';
            ctx.fillRect(14*s, 6*s, 12*s, 10*s);
            // –õ–∏—Ü–æ meme
            ctx.fillStyle = '#000';
            ctx.fillRect(15*s, 9*s, 3*s, 2*s);
            ctx.fillRect(22*s, 9*s, 3*s, 2*s);
            ctx.beginPath();
            ctx.moveTo(16*s, 13*s);
            ctx.lineTo(20*s, 15*s);
            ctx.lineTo(24*s, 13*s);
            ctx.stroke();
            // Nyan cat —Ä–∞–¥—É–≥–∞
            const rainbow = ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#8b00ff'];
            for (let i = 0; i < 6; i++) {
                ctx.fillStyle = rainbow[i];
                ctx.fillRect(0, (16 + i*3)*s, 40*s, 3*s);
            }
            // Nyan cat —Ç–µ–ª–æ
            ctx.fillStyle = '#ffb6c1';
            ctx.fillRect(28*s, 18*s, 10*s, 8*s);
            ctx.fillStyle = '#ff69b4';
            for (let i = 0; i < 3; i++) {
                ctx.fillRect((30 + i*2)*s, 20*s, 1.5*s, 1.5*s);
            }
            // –¢–µ–ª–æ —á–µ—Ä–Ω–æ–µ
            ctx.fillStyle = '#111';
            ctx.fillRect(12*s, 16*s, 16*s, 12*s);
            // –†–∞–¥—É–∂–Ω—ã–µ –ø–æ–ª–æ—Å—ã
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(10*s, 18*s, 2*s, 8*s);
            ctx.fillStyle = '#00ff00';
            ctx.fillRect(28*s, 18*s, 2*s, 8*s);
            // –ù–æ–≥–∏
            ctx.fillStyle = '#222';
            ctx.fillRect(14*s, 28*s, 5*s, 12*s);
            ctx.fillRect(21*s, 28*s, 5*s, 12*s);
            // –†–∞–¥—É–∂–Ω—ã–µ –ø–æ–ª–æ—Å—ã –Ω–∞ –Ω–æ–≥–∞—Ö
            ctx.fillStyle = '#ff00ff';
            ctx.fillRect(12*s, 30*s, 2*s, 8*s);
            ctx.fillRect(26*s, 30*s, 2*s, 8*s);
            ctx.restore();
        }

        function drawPapa(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);
            // –ö–µ–ø–∫–∞ ROBLOX
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(13*s, 1*s, 14*s, 5*s);
            ctx.fillRect(11*s, 5*s, 18*s, 2*s);
            ctx.fillStyle = '#fff';
            ctx.font = `${4*s}px Arial`;
            ctx.fillText('R', 18*s, 5*s);
            // –ñ–µ–ª—Ç–∞—è –≥–æ–ª–æ–≤–∞
            ctx.fillStyle = '#ffff00';
            ctx.fillRect(14*s, 6*s, 12*s, 10*s);
            // –°–º–∞–π–ª–∏–∫
            ctx.fillStyle = '#000';
            ctx.fillRect(16*s, 9*s, 2*s, 3*s);
            ctx.fillRect(22*s, 9*s, 2*s, 3*s);
            ctx.beginPath();
            ctx.arc(20*s, 13*s, 3*s, 0.1, Math.PI - 0.1);
            ctx.stroke();
            // –¢–µ–ª–æ —á–µ—Ä–Ω–æ–µ —Å –Ω–µ–æ–Ω–æ–≤—ã–º–∏ –∞–º–æ–Ω–≥—É—Å–∞–º–∏
            ctx.fillStyle = '#111';
            ctx.fillRect(10*s, 16*s, 20*s, 14*s);
            // –ù–µ–æ–Ω–æ–≤—ã–µ –∞–º–æ–Ω–≥—É—Å—ã
            ctx.strokeStyle = '#00ffff';
            ctx.lineWidth = 1*s;
            // –ê–º–æ–Ω–≥—É—Å 1
            ctx.beginPath();
            ctx.arc(16*s, 22*s, 3*s, 0, Math.PI * 2);
            ctx.moveTo(14*s, 25*s); ctx.lineTo(14*s, 28*s);
            ctx.moveTo(18*s, 25*s); ctx.lineTo(18*s, 28*s);
            ctx.stroke();
            // –ê–º–æ–Ω–≥—É—Å 2
            ctx.strokeStyle = '#ff00ff';
            ctx.beginPath();
            ctx.arc(24*s, 22*s, 3*s, 0, Math.PI * 2);
            ctx.stroke();
            // SuS —Ç–µ–∫—Å—Ç
            ctx.fillStyle = '#00ff00';
            ctx.font = `bold ${5*s}px Arial`;
            ctx.fillText('SuS', 15*s, 28*s);
            // –†–∞–¥—É–∂–Ω—ã–µ –∫—Ä–∞—è
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(8*s, 17*s, 2*s, 12*s);
            ctx.fillStyle = '#00ff00';
            ctx.fillRect(30*s, 17*s, 2*s, 12*s);
            ctx.fillStyle = '#0000ff';
            ctx.fillRect(8*s, 29*s, 24*s, 2*s);
            // –ù–æ–≥–∏
            ctx.fillStyle = '#222';
            ctx.fillRect(14*s, 30*s, 5*s, 10*s);
            ctx.fillRect(21*s, 30*s, 5*s, 10*s);
            // –†–∞–¥—É–∂–Ω—ã–µ –ø–æ–ª–æ—Å—ã
            ctx.fillStyle = '#ff00ff';
            ctx.fillRect(12*s, 32*s, 2*s, 6*s);
            ctx.fillStyle = '#00ffff';
            ctx.fillRect(26*s, 32*s, 2*s, 6*s);
            ctx.restore();
        }

        // –°–∫–∏–Ω "–ë–∏–ª–µ—Ç" (Battle Pass Level 45)
        function drawTicket(ctx, x, y, size) {
            const s = size / 40;
            ctx.save();
            ctx.translate(x, y);

            // –û—Å–Ω–æ–≤–∞ –±–∏–ª–µ—Ç–∞ (–≥–æ–ª—É–±–æ–π)
            ctx.fillStyle = '#00d4ff';
            ctx.beginPath();
            ctx.roundRect(2*s, 8*s, 36*s, 24*s, 4*s);
            ctx.fill();

            // –¢–µ–Ω—å –≤–Ω—É—Ç—Ä–∏
            ctx.fillStyle = '#00a8cc';
            ctx.fillRect(4*s, 10*s, 32*s, 20*s);

            // –ß–µ—Ä–µ–ø/–ª–∏—Ü–æ (—á–µ—Ä–Ω–æ–µ)
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(18*s, 20*s, 10*s, 0, Math.PI * 2);
            ctx.fill();

            // –ì–ª–∞–∑–∞ —á–µ—Ä–µ–ø–∞ (–∫—Ä–∞—Å–Ω—ã–µ –∑–ª—ã–µ)
            ctx.fillStyle = '#ff0000';
            ctx.beginPath();
            ctx.arc(14*s, 18*s, 3*s, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(22*s, 18*s, 3*s, 0, Math.PI * 2);
            ctx.fill();

            // –ó–ª—ã–µ –±—Ä–æ–≤–∏
            ctx.strokeStyle = '#ff0000';
            ctx.lineWidth = 2*s;
            ctx.beginPath();
            ctx.moveTo(11*s, 14*s);
            ctx.lineTo(16*s, 16*s);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(25*s, 14*s);
            ctx.lineTo(20*s, 16*s);
            ctx.stroke();

            // –†–æ—Ç (–∑—É–±—ã)
            ctx.fillStyle = '#fff';
            ctx.fillRect(13*s, 24*s, 10*s, 4*s);
            ctx.fillStyle = '#000';
            for(let i = 0; i < 4; i++) {
                ctx.fillRect((14 + i*2.5)*s, 24*s, 1*s, 4*s);
            }

            // –ö—Ä—É–≥–∏ —Å–ø—Ä–∞–≤–∞ (–∫–∞–∫ –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–µ–º –±–∏–ª–µ—Ç–µ)
            ctx.fillStyle = '#00a8cc';
            ctx.beginPath();
            ctx.arc(35*s, 14*s, 2*s, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(35*s, 20*s, 2*s, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(35*s, 26*s, 2*s, 0, Math.PI * 2);
            ctx.fill();

            // –°–≤–µ—á–µ–Ω–∏–µ
            ctx.shadowColor = '#00d4ff';
            ctx.shadowBlur = 10*s;
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 1*s;
            ctx.beginPath();
            ctx.roundRect(2*s, 8*s, 36*s, 24*s, 4*s);
            ctx.stroke();

            ctx.restore();
        }

        // –°–∫–∏–Ω—ã
        const SKINS = [
            { id: 'mannequin', name: '–ú–∞–Ω–µ–∫–µ–Ω', draw: drawMannequin, price: 0, owned: true },
            { id: 'knife', name: '–ù–æ–∂', draw: drawKnife, price: 10, owned: false },
            { id: 'amongus', name: '–ê–º–æ–Ω–≥—É—Å', draw: drawAmongUs, price: 20, owned: false },
            { id: 'sonic', name: '–°–æ–Ω–∏–∫', draw: drawSonic, price: 30, owned: false },
            { id: 'skin67', name: '–°–∫–∏–Ω 67', draw: draw67, price: -1, owned: false, promo: true },
            { id: 'blackstick1', name: 'Black Stick', draw: drawBlackStick1, price: -1, owned: false, cheat: true },
            { id: 'blackstick2', name: 'Black Stick II', draw: drawBlackStick2, price: -1, owned: false, cheat: true },
            { id: 'blackstick3', name: 'Black Stick III', draw: drawBlackStick3, price: -1, owned: false, cheat: true },
            { id: 'pavel', name: '–ü–∞–≤–µ–ª', draw: drawPavel, price: -1, owned: false, promo: true, promoCode: '–∞–¥–º–∏–Ω4444' },
            { id: 'daniel', name: '–î–∞–Ω–∏—ç–ª—å', draw: drawDaniel, price: -1, owned: false, promo: true, promoCode: '–∞–¥–º–∏–Ω4444' },
            { id: 'teo', name: '–¢–µ–æ', draw: drawTeo, price: -1, owned: false, promo: true, promoCode: '–∞–¥–º–∏–Ω4444' },
            { id: 'papa', name: '–ü–∞–ø–∞', draw: drawPapa, price: -1, owned: false, promo: true, promoCode: '–∞–¥–º–∏–Ω4444' },
            { id: 'ticket', name: '–ë–∏–ª–µ—Ç', draw: drawTicket, price: -1, owned: false, passLevel: 45 }
        ];

        const DIFFICULTIES = {
            easy: { name: '–õ–µ–≥–∫–æ', gravity: 0.35, jump: -8, pipeSpeed: 2.5, gap: 180, spawn: 120 },
            normal: { name: '–ù–æ—Ä–º–∞–ª—å–Ω–æ', gravity: 0.5, jump: -9, pipeSpeed: 3, gap: 150, spawn: 100 },
            hard: { name: '–°–ª–æ–∂–Ω–æ', gravity: 0.6, jump: -10, pipeSpeed: 4, gap: 120, spawn: 80 }
        };

        let gameState = {
            totalScore: parseInt(localStorage.getItem('flappyTotalScore')) || 0,
            bestScore: parseInt(localStorage.getItem('flappyBestScore')) || 0,
            currentSkin: localStorage.getItem('flappyCurrentSkin') || 'mannequin',
            ownedSkins: JSON.parse(localStorage.getItem('flappyOwnedSkins')) || ['mannequin'],
            usedPromoCodes: JSON.parse(localStorage.getItem('flappyUsedPromos')) || [],
            difficulty: localStorage.getItem('flappyDifficulty') || 'normal'
        };

        let player = { x: 80, y: 300, velocity: 0, width: 40, height: 40 };
        let pipes = [];
        let score = 0;
        let gameRunning = false;
        let animationId = null;
        let frameCount = 0;
        let currentDiff = DIFFICULTIES[gameState.difficulty];

        // –ß–∏—Ç—ã
        let cheats = {
            godMode: false,
            autoJump: false,
            slowMo: false,
            megaJump: false,
            wideGap: false,
            invisPipes: false,
            miniSize: false,
            freezePipes: false,
            flyMode: false,
            doubleScore: false,
            rainbowMode: false,
            noPipes: false
        };

        function openCheats() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('cheatsMenu').classList.remove('hidden');
            updateCheatButtons();
        }

        function closeCheats() {
            document.getElementById('cheatsMenu').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
        }

        function toggleCheat(cheatName) {
            cheats[cheatName] = !cheats[cheatName];
            updateCheatButtons();
        }

        function updateCheatButtons() {
            const buttons = {
                godMode: 'godModeBtn',
                autoJump: 'autoJumpBtn',
                slowMo: 'slowMoBtn',
                megaJump: 'megaJumpBtn',
                wideGap: 'wideGapBtn',
                invisPipes: 'invisPipesBtn',
                miniSize: 'miniSizeBtn',
                freezePipes: 'freezePipesBtn',
                flyMode: 'flyModeBtn',
                doubleScore: 'doubleScoreBtn',
                rainbowMode: 'rainbowModeBtn',
                noPipes: 'noPipesBtn'
            };
            for (const [cheat, btnId] of Object.entries(buttons)) {
                const btn = document.getElementById(btnId);
                if (btn) {
                    if (cheats[cheat]) {
                        btn.textContent = 'ON';
                        btn.className = 'cheat-toggle on';
                    } else {
                        btn.textContent = 'OFF';
                        btn.className = 'cheat-toggle off';
                    }
                }
            }
        }

        function cheatAddCoins() {
            gameState.totalScore += 1000;
            saveState();
            updateUI();
            alert('–î–æ–±–∞–≤–ª–µ–Ω–æ 1000 –æ—á–∫–æ–≤!');
        }

        function cheatAdd10k() {
            gameState.totalScore += 10000;
            saveState();
            updateUI();
            alert('–î–æ–±–∞–≤–ª–µ–Ω–æ 10000 –æ—á–∫–æ–≤!');
        }

        function cheatMaxScore() {
            gameState.bestScore = 9999;
            saveState();
            updateUI();
            alert('–†–µ–∫–æ—Ä–¥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: 9999!');
        }

        function cheatUnlockAll() {
            SKINS.forEach(skin => {
                if (!gameState.ownedSkins.includes(skin.id)) {
                    gameState.ownedSkins.push(skin.id);
                }
            });
            saveState();
            alert('–í—Å–µ —Å–∫–∏–Ω—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã!');
        }

        function cheatResetProgress() {
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –í–°–ï –ø—Ä–æ–≥—Ä–µ—Å—Å? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –æ—á–∫–∏, —Å–∫–∏–Ω—ã –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è!')) {
                localStorage.removeItem('flappyTotalScore');
                localStorage.removeItem('flappyBestScore');
                localStorage.removeItem('flappyCurrentSkin');
                localStorage.removeItem('flappyOwnedSkins');
                localStorage.removeItem('flappyUsedPromos');
                localStorage.removeItem('flappyDifficulty');
                location.reload();
            }
        }

        function cheatDisableAll() {
            for (const key in cheats) {
                cheats[key] = false;
            }
            updateCheatButtons();
        }

        function cheatEnableAll() {
            for (const key in cheats) {
                cheats[key] = true;
            }
            updateCheatButtons();
        }

        // Battle Pass —Ñ—É–Ω–∫—Ü–∏–∏
        function getPassLevel() {
            return Math.floor(gameState.totalScore / 10);
        }

        function getPassProgress() {
            return gameState.totalScore % 10;
        }

        function openPass() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('passMenu').classList.remove('hidden');
            renderPassUI();
        }

        function closePass() {
            document.getElementById('passMenu').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
        }

        function renderPassUI() {
            const level = getPassLevel();
            const progress = getPassProgress();

            document.getElementById('passLevel').textContent = level;
            document.getElementById('passProgressFill').style.width = (progress * 10) + '%';
            document.getElementById('passProgressText').textContent = `${progress} / 10 –æ—á–∫–æ–≤ –¥–æ —Å–ª–µ–¥. —É—Ä–æ–≤–Ω—è`;

            renderPassRewards(level);
        }

        function renderPassRewards(currentLevel) {
            const container = document.getElementById('passRewards');
            const rewards = [
                { level: 5, name: '+50 –æ—á–∫–æ–≤', type: 'coins', amount: 50 },
                { level: 10, name: '+100 –æ—á–∫–æ–≤', type: 'coins', amount: 100 },
                { level: 15, name: '+150 –æ—á–∫–æ–≤', type: 'coins', amount: 150 },
                { level: 20, name: '+200 –æ—á–∫–æ–≤', type: 'coins', amount: 200 },
                { level: 25, name: '+300 –æ—á–∫–æ–≤', type: 'coins', amount: 300 },
                { level: 30, name: '+400 –æ—á–∫–æ–≤', type: 'coins', amount: 400 },
                { level: 35, name: '+500 –æ—á–∫–æ–≤', type: 'coins', amount: 500 },
                { level: 40, name: '+750 –æ—á–∫–æ–≤', type: 'coins', amount: 750 },
                { level: 45, name: '–°–∫–∏–Ω "–ë–∏–ª–µ—Ç"', type: 'skin', skinId: 'ticket' }
            ];

            container.innerHTML = rewards.map(reward => {
                const unlocked = currentLevel >= reward.level;
                const isCurrent = currentLevel === reward.level - 1 ||
                                  (currentLevel >= reward.level && !rewards.find(r => r.level > reward.level && currentLevel < r.level));
                const isExclusive = reward.type === 'skin';

                let statusClass = '';
                if (unlocked) statusClass = 'unlocked';
                else if (isCurrent) statusClass = 'current';
                if (isExclusive) statusClass += ' exclusive';

                let icon = 'üéÅ';
                if (reward.type === 'coins') icon = 'üí∞';
                if (reward.type === 'skin') icon = '‚≠ê';

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É
                if (unlocked && reward.type === 'skin') {
                    if (!gameState.ownedSkins.includes(reward.skinId)) {
                        gameState.ownedSkins.push(reward.skinId);
                        saveState();
                    }
                }

                return `
                    <div class="pass-reward-item ${statusClass}">
                        <div class="pass-reward-level">${reward.level}</div>
                        <div class="pass-reward-info">
                            <h4>${reward.name}</h4>
                            <p>${unlocked ? '‚úì –ü–æ–ª—É—á–µ–Ω–æ' : isExclusive ? '–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π —Å–∫–∏–Ω!' : '–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ —É—Ä–æ–≤–µ–Ω—å'}</p>
                        </div>
                        <div class="pass-reward-icon">${icon}</div>
                    </div>
                `;
            }).join('');
        }

        // Fan Skins —Ñ—É–Ω–∫—Ü–∏–∏
        let fanSkins = [];
        let myVotes = JSON.parse(localStorage.getItem('flappyFanVotes')) || [];
        let currentFanTab = 'vote';
        let drawColor = '#000000';
        let isDrawing = false;
        let drawCtx = null;

        function openFanSkins() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('fanMenu').classList.remove('hidden');
            loadFanSkins();
        }

        function closeFanSkins() {
            document.getElementById('fanMenu').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
        }

        function switchFanTab(tab, btn) {
            currentFanTab = tab;
            document.querySelectorAll('.fan-tab').forEach(t => t.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderFanSkins();
        }

        function loadFanSkins() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫–∏–Ω—ã –∏–∑ localStorage
            fanSkins = JSON.parse(localStorage.getItem('flappyFanSkins')) || [];

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≥–æ–ª–æ—Å–∞–º
            fanSkins.sort((a, b) => b.votes - a.votes);
            renderFanSkins();
        }

        function saveFanSkins() {
            localStorage.setItem('flappyFanSkins', JSON.stringify(fanSkins));
        }

        function renderFanSkins() {
            const grid = document.getElementById('fanSkinsGrid');
            let skinsToShow = fanSkins;

            if (currentFanTab === 'winners') {
                skinsToShow = fanSkins.filter(s => s.isWinner);
            }

            if (skinsToShow.length === 0) {
                grid.innerHTML = `<div style="color: white; text-align: center; padding: 20px; line-height: 1.6;">
                    ${currentFanTab === 'winners' ? '–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π' : `
                        <p style="font-size: 16px; margin-bottom: 10px;">üé® –ü–æ–∫–∞ –Ω–µ—Ç —Å–∫–∏–Ω–æ–≤</p>
                        <p style="font-size: 12px; color: #ddd;">1. –ù–∞—Ä–∏—Å—É–π —Å–≤–æ–π —Å–∫–∏–Ω</p>
                        <p style="font-size: 12px; color: #ddd;">2. –ù–∞–∂–º–∏ "üì§ –ö–æ–¥" —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</p>
                        <p style="font-size: 12px; color: #ddd;">3. –û—Ç–ø—Ä–∞–≤—å –∫–æ–¥ –¥—Ä—É–≥—É!</p>
                        <p style="font-size: 11px; color: #aaa; margin-top: 10px;">–î—Ä—É–≥ –¥–æ–±–∞–≤–∏—Ç —Ç–≤–æ–π —Å–∫–∏–Ω —á–µ—Ä–µ–∑ "üì• –î–æ–±–∞–≤–∏—Ç—å —Å–∫–∏–Ω –¥—Ä—É–≥–∞"</p>
                    `}
                </div>`;
                return;
            }

            grid.innerHTML = skinsToShow.map(skin => {
                const voted = myVotes.includes(skin.id);
                const canShare = skin.imageData && !skin.isDemo;
                return `
                    <div class="fan-skin-card ${skin.isWinner ? 'winner' : ''}">
                        <div class="fan-skin-preview">
                            ${skin.imageData
                                ? `<img src="${skin.imageData}" width="40" height="40" style="image-rendering: pixelated;">`
                                : `<span style="font-size: 24px;">üé®</span>`
                            }
                        </div>
                        <div class="fan-skin-info">
                            <h4>${skin.name}${skin.isWinner ? ' üèÜ' : ''}</h4>
                            <p class="author">–æ—Ç ${skin.author}</p>
                            ${canShare ? `<button onclick="shareSkin('${skin.id}')" style="background: #2196F3; border: none; color: white; padding: 3px 8px; border-radius: 10px; font-size: 10px; cursor: pointer; margin-top: 3px;">üì§ –ö–æ–¥</button>` : ''}
                        </div>
                        <div class="fan-skin-votes">
                            <span class="vote-count">${skin.votes}</span>
                            <button class="vote-btn ${voted ? 'voted' : ''}"
                                    onclick="voteFanSkin('${skin.id}')"
                                    ${voted ? 'disabled' : ''}>
                                ${voted ? '‚úì' : 'üëç'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function voteFanSkin(skinId) {
            if (myVotes.includes(skinId)) return;

            myVotes.push(skinId);
            localStorage.setItem('flappyFanVotes', JSON.stringify(myVotes));

            const skin = fanSkins.find(s => s.id === skinId);
            if (skin) {
                skin.votes++;
                saveFanSkins();
                fanSkins.sort((a, b) => b.votes - a.votes);
                renderFanSkins();
            }
        }

        function openDrawModal() {
            document.getElementById('drawModal').classList.remove('hidden');
            const canvas = document.getElementById('drawCanvas');
            drawCtx = canvas.getContext('2d');
            drawCtx.fillStyle = '#ffffff';
            drawCtx.fillRect(0, 0, canvas.width, canvas.height);
            setupDrawCanvas(canvas);
        }

        function closeDrawModal() {
            document.getElementById('drawModal').classList.add('hidden');
            document.getElementById('skinNameInput').value = '';
        }

        function setupDrawCanvas(canvas) {
            const getPos = (e) => {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                if (e.touches) {
                    return {
                        x: (e.touches[0].clientX - rect.left) * scaleX,
                        y: (e.touches[0].clientY - rect.top) * scaleY
                    };
                }
                return {
                    x: (e.clientX - rect.left) * scaleX,
                    y: (e.clientY - rect.top) * scaleY
                };
            };

            const draw = (e) => {
                if (!isDrawing) return;
                e.preventDefault();
                const pos = getPos(e);
                drawCtx.fillStyle = drawColor;
                drawCtx.beginPath();
                drawCtx.arc(pos.x, pos.y, 3, 0, Math.PI * 2);
                drawCtx.fill();
            };

            canvas.onmousedown = (e) => { isDrawing = true; draw(e); };
            canvas.onmousemove = draw;
            canvas.onmouseup = () => isDrawing = false;
            canvas.onmouseleave = () => isDrawing = false;

            canvas.ontouchstart = (e) => { isDrawing = true; draw(e); };
            canvas.ontouchmove = draw;
            canvas.ontouchend = () => isDrawing = false;
        }

        function setDrawColor(color, btn) {
            drawColor = color;
            document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
        }

        function clearDrawCanvas() {
            const canvas = document.getElementById('drawCanvas');
            drawCtx.fillStyle = '#ffffff';
            drawCtx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function submitFanSkin() {
            const name = document.getElementById('skinNameInput').value.trim();
            if (!name) {
                alert('–í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∫–∏–Ω–∞!');
                return;
            }

            const canvas = document.getElementById('drawCanvas');
            const imageData = canvas.toDataURL('image/png');

            const authorName = playerName || '–ò–≥—Ä–æ–∫_' + Math.floor(Math.random() * 1000);

            const newSkin = {
                id: 'user_' + Date.now(),
                name: name,
                author: authorName,
                votes: 1, // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≥–æ–ª–æ—Å –∑–∞ —Å–≤–æ–π —Å–∫–∏–Ω
                imageData: imageData,
                isWinner: false,
                isDemo: false,
                createdAt: Date.now()
            };

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞
            fanSkins.unshift(newSkin);

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            saveFanSkins();

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º
            fanSkins.sort((a, b) => b.votes - a.votes);
            renderFanSkins();

            alert('üéâ –°–∫–∏–Ω "' + name + '" –¥–æ–±–∞–≤–ª–µ–Ω! –î—Ä—É–≥–∏–µ –º–æ–≥—É—Ç –∑–∞ –Ω–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å.');
            closeDrawModal();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –æ–±–º–µ–Ω–∞ —Å–∫–∏–Ω–∞–º–∏
        function shareSkin(skinId) {
            const skin = fanSkins.find(s => s.id === skinId);
            if (!skin || !skin.imageData) return;

            // –°–æ–∑–¥–∞—ë–º –∫–æ–¥ –¥–ª—è –æ–±–º–µ–Ω–∞ (—Å–∂–∞—Ç—ã–π JSON –≤ base64)
            const shareData = {
                n: skin.name,
                a: skin.author,
                i: skin.imageData
            };
            const code = btoa(unescape(encodeURIComponent(JSON.stringify(shareData))));

            // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            if (navigator.clipboard) {
                navigator.clipboard.writeText(code).then(() => {
                    alert('üìã –ö–æ–¥ —Å–∫–∏–Ω–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!\n\n–û—Ç–ø—Ä–∞–≤—å –µ–≥–æ –¥—Ä—É–≥—É, –∏ –æ–Ω —Å–º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —Ç–≤–æ–π —Å–∫–∏–Ω.');
                }).catch(() => {
                    prompt('üìã –°–∫–æ–ø–∏—Ä—É–π —ç—Ç–æ—Ç –∫–æ–¥ –∏ –æ—Ç–ø—Ä–∞–≤—å –¥—Ä—É–≥—É:', code);
                });
            } else {
                prompt('üìã –°–∫–æ–ø–∏—Ä—É–π —ç—Ç–æ—Ç –∫–æ–¥ –∏ –æ—Ç–ø—Ä–∞–≤—å –¥—Ä—É–≥—É:', code);
            }
        }

        function openImportModal() {
            document.getElementById('importModal').classList.remove('hidden');
            document.getElementById('importCodeInput').value = '';
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.add('hidden');
        }

        function importFanSkin() {
            const code = document.getElementById('importCodeInput').value.trim();
            if (!code) {
                alert('–í—Å—Ç–∞–≤—å –∫–æ–¥ —Å–∫–∏–Ω–∞!');
                return;
            }

            try {
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º –∫–æ–¥
                const jsonStr = decodeURIComponent(escape(atob(code)));
                const data = JSON.parse(jsonStr);

                if (!data.n || !data.i) {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç');
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ —Å–∫–∏–Ω–∞
                const exists = fanSkins.some(s => s.imageData === data.i);
                if (exists) {
                    alert('–≠—Ç–æ—Ç —Å–∫–∏–Ω —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω!');
                    return;
                }

                // –î–æ–±–∞–≤–ª—è–µ–º —Å–∫–∏–Ω
                const newSkin = {
                    id: 'imported_' + Date.now(),
                    name: data.n,
                    author: data.a || '–î—Ä—É–≥',
                    votes: 0,
                    imageData: data.i,
                    isWinner: false,
                    isDemo: false,
                    createdAt: Date.now()
                };

                fanSkins.unshift(newSkin);
                saveFanSkins();
                fanSkins.sort((a, b) => b.votes - a.votes);
                renderFanSkins();

                alert('‚úÖ –°–∫–∏–Ω "' + data.n + '" –¥–æ–±–∞–≤–ª–µ–Ω!');
                closeImportModal();

            } catch (e) {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥! –ü–æ–ø—Ä–æ—Å–∏ –¥—Ä—É–≥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∑–∞–Ω–æ–≤–æ.');
            }
        }

        // Online —Ñ—É–Ω–∫—Ü–∏–∏
        function updateOnlinePresence() {
            if (!db || !playerName) return;
            const playerRef = db.ref('players/' + playerId);
            playerRef.set({
                name: playerName,
                score: gameState.bestScore,
                skin: gameState.currentSkin,
                lastSeen: Date.now()
            });
            playerRef.onDisconnect().remove();
        }

        function listenToOnlinePlayers() {
            if (!db) return;
            db.ref('players').on('value', (snapshot) => {
                const players = snapshot.val() || {};
                const count = Object.keys(players).length;
                document.getElementById('onlineCount').textContent = count;

                // –õ–∏–¥–µ—Ä–±–æ—Ä–¥
                const list = document.getElementById('leaderboardList');
                const sorted = Object.entries(players)
                    .map(([id, data]) => ({ id, ...data }))
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 10);

                list.innerHTML = sorted.map((p, i) =>
                    `<div class="leaderboard-item ${p.id === playerId ? 'me' : ''}">
                        <span>${i + 1}. ${p.name}</span>
                        <span>${p.score}</span>
                    </div>`
                ).join('');
            });
        }

        function listenToChat() {
            if (!db) return;
            db.ref('chat').orderByChild('time').limitToLast(50).on('child_added', (snapshot) => {
                const msg = snapshot.val();
                const container = document.getElementById('chatMessages');
                const div = document.createElement('div');
                div.className = 'chat-msg' + (msg.system ? ' system' : '');
                div.innerHTML = msg.system
                    ? `<span class="text">${msg.text}</span>`
                    : `<span class="name">${msg.name}:</span> <span class="text">${msg.text}</span>`;
                container.appendChild(div);
                container.scrollTop = container.scrollHeight;
            });
        }

        function sendChatMessage() {
            if (!db || !playerName) return;
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;

            db.ref('chat').push({
                name: playerName,
                text: text,
                time: Date.now()
            });
            input.value = '';
        }

        function setPlayerName() {
            const input = document.getElementById('playerNameInput');
            const name = input.value.trim();
            if (!name) return;

            playerName = name;
            localStorage.setItem('flappyPlayerName', name);
            document.getElementById('nameInputRow').style.display = 'none';

            updateOnlinePresence();

            if (db) {
                db.ref('chat').push({
                    system: true,
                    text: `${name} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è!`,
                    time: Date.now()
                });
            }
        }

        function openOnline() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('onlineMenu').classList.remove('hidden');

            if (playerName) {
                document.getElementById('playerNameInput').value = playerName;
                document.getElementById('nameInputRow').style.display = 'none';
                updateOnlinePresence();
            } else {
                document.getElementById('nameInputRow').style.display = 'flex';
            }

            listenToOnlinePlayers();
            listenToChat();
        }

        function closeOnline() {
            document.getElementById('onlineMenu').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
            isOnlineMode = false;
        }

        function startOnlineGame() {
            if (!playerName) {
                alert('–í–≤–µ–¥–∏ –Ω–∏–∫!');
                return;
            }
            isOnlineMode = true;
            startGame();
        }

        // UI —Ñ—É–Ω–∫—Ü–∏–∏
        function updateMenuPreview() {
            const previewCanvas = document.getElementById('menuSkinPreview');
            const previewCtx = previewCanvas.getContext('2d');
            previewCtx.clearRect(0, 0, 50, 50);
            const currentSkinData = SKINS.find(s => s.id === gameState.currentSkin);
            if (currentSkinData && currentSkinData.draw) {
                currentSkinData.draw(previewCtx, 5, 2, 40);
            }
        }

        function updateUI() {
            document.getElementById('totalScore').textContent = gameState.totalScore;
            document.getElementById('skinsBalance').textContent = gameState.totalScore;
            document.getElementById('bestScore').textContent = gameState.bestScore;
            document.getElementById('currentDiffBadge').textContent = DIFFICULTIES[gameState.difficulty].name;
            updateMenuPreview();
            updateDifficultyButtons();
        }

        function updateDifficultyButtons() {
            document.querySelectorAll('.diff-btn').forEach(btn => btn.classList.remove('selected-diff'));
            const selectedBtn = document.querySelector(`.diff-btn.${gameState.difficulty}`);
            if (selectedBtn) selectedBtn.classList.add('selected-diff');
        }

        function saveState() {
            localStorage.setItem('flappyTotalScore', gameState.totalScore);
            localStorage.setItem('flappyBestScore', gameState.bestScore);
            localStorage.setItem('flappyCurrentSkin', gameState.currentSkin);
            localStorage.setItem('flappyOwnedSkins', JSON.stringify(gameState.ownedSkins));
            localStorage.setItem('flappyUsedPromos', JSON.stringify(gameState.usedPromoCodes));
            localStorage.setItem('flappyDifficulty', gameState.difficulty);
        }

        function showMainMenu() {
            document.getElementById('mainMenu').classList.remove('hidden');
            document.getElementById('gameOver').classList.add('hidden');
            document.getElementById('skinsMenu').classList.add('hidden');
            document.getElementById('promoMenu').classList.add('hidden');
            document.getElementById('difficultyMenu').classList.add('hidden');
            document.getElementById('onlineMenu').classList.add('hidden');
            document.getElementById('cheatsMenu').classList.add('hidden');
            document.getElementById('passMenu').classList.add('hidden');
            document.getElementById('fanMenu').classList.add('hidden');
            document.getElementById('drawModal').classList.add('hidden');
            document.getElementById('importModal').classList.add('hidden');
            document.getElementById('jumpZone').style.display = 'none';
            isOnlineMode = false;
            updateUI();
        }

        function openSkins() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('skinsMenu').classList.remove('hidden');
            renderSkins();
        }

        function closeSkins() {
            document.getElementById('skinsMenu').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
            updateUI();
        }

        function openDifficulty() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('difficultyMenu').classList.remove('hidden');
            updateDifficultyButtons();
        }

        function closeDifficulty() {
            document.getElementById('difficultyMenu').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
        }

        function setDifficulty(diff) {
            gameState.difficulty = diff;
            currentDiff = DIFFICULTIES[diff];
            saveState();
            updateDifficultyButtons();
            updateUI();
        }

        function openPromo() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('promoMenu').classList.remove('hidden');
            document.getElementById('promoMessage').textContent = '';
            document.getElementById('promoInput').value = '';
        }

        function closePromo() {
            document.getElementById('promoMenu').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
        }

        function renderSkins() {
            const grid = document.getElementById('skinsGrid');
            grid.innerHTML = '';

            SKINS.forEach(skin => {
                const owned = gameState.ownedSkins.includes(skin.id);
                const selected = gameState.currentSkin === skin.id;
                const canBuy = !skin.promo && !skin.cheat && gameState.totalScore >= skin.price;

                const item = document.createElement('div');
                let itemClass = 'skin-item';
                if (selected) itemClass += ' selected';
                else if (owned) itemClass += ' owned';
                else if (skin.cheat) itemClass += ' locked-cheat';
                item.className = itemClass;

                let btnHtml = '';
                let priceText = '';

                if (skin.cheat) {
                    btnHtml = '<button class="skin-btn cheat-locked">–ß–ò–¢</button>';
                    priceText = '<span class="skin-price cheat">–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>';
                } else if (skin.passLevel) {
                    const currentLevel = getPassLevel();
                    if (owned || currentLevel >= skin.passLevel) {
                        if (!gameState.ownedSkins.includes(skin.id)) {
                            gameState.ownedSkins.push(skin.id);
                            saveState();
                        }
                        if (selected) {
                            btnHtml = '<button class="skin-btn selected">–í—ã–±—Ä–∞–Ω</button>';
                        } else {
                            btnHtml = `<button class="skin-btn select" onclick="selectSkin('${skin.id}')">–í—ã–±—Ä–∞—Ç—å</button>`;
                        }
                        priceText = 'Battle Pass Lv.' + skin.passLevel;
                    } else {
                        btnHtml = '<button class="skin-btn locked">–ü–∞—Å—Å</button>';
                        priceText = 'Battle Pass Lv.' + skin.passLevel;
                    }
                } else if (selected) {
                    btnHtml = '<button class="skin-btn selected">–í—ã–±—Ä–∞–Ω</button>';
                    priceText = skin.price === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : `${skin.price} –æ—á–∫–æ–≤`;
                } else if (owned) {
                    btnHtml = `<button class="skin-btn select" onclick="selectSkin('${skin.id}')">–í—ã–±—Ä–∞—Ç—å</button>`;
                    priceText = skin.price === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : `${skin.price} –æ—á–∫–æ–≤`;
                } else if (skin.promo) {
                    btnHtml = '<button class="skin-btn locked">–ü—Ä–æ–º–æ–∫–æ–¥</button>';
                    priceText = skin.promoCode ? '–ê–¥–º–∏–Ω' : '–ü—Ä–æ–º–æ–∫–æ–¥';
                } else if (canBuy) {
                    btnHtml = `<button class="skin-btn buy" onclick="buySkin('${skin.id}')">–ö—É–ø–∏—Ç—å</button>`;
                    priceText = `${skin.price} –æ—á–∫–æ–≤`;
                } else {
                    btnHtml = '<button class="skin-btn locked">–ú–∞–ª–æ</button>';
                    priceText = `${skin.price} –æ—á–∫–æ–≤`;
                }

                const iconDiv = document.createElement('div');
                iconDiv.className = 'skin-icon';
                const miniCanvas = document.createElement('canvas');
                miniCanvas.width = 40;
                miniCanvas.height = 40;
                const miniCtx = miniCanvas.getContext('2d');
                skin.draw(miniCtx, 0, 0, 40);
                iconDiv.appendChild(miniCanvas);

                item.innerHTML = `
                    <div class="skin-info">
                        <h3>${skin.name}</h3>
                        <p class="skin-price ${skin.cheat ? 'cheat' : ''}">${priceText}</p>
                    </div>
                    ${btnHtml}
                `;
                item.insertBefore(iconDiv, item.firstChild);
                grid.appendChild(item);
            });
        }

        function buySkin(skinId) {
            const skin = SKINS.find(s => s.id === skinId);
            if (!skin || gameState.ownedSkins.includes(skinId)) return;
            if (skin.cheat || skin.promo) return;
            if (gameState.totalScore < skin.price) return;

            gameState.totalScore -= skin.price;
            gameState.ownedSkins.push(skinId);
            gameState.currentSkin = skinId;
            saveState();
            renderSkins();
            document.getElementById('skinsBalance').textContent = gameState.totalScore;
        }

        function selectSkin(skinId) {
            const skin = SKINS.find(s => s.id === skinId);
            if (!gameState.ownedSkins.includes(skinId)) return;
            if (skin && skin.cheat) return;
            gameState.currentSkin = skinId;
            saveState();
            renderSkins();
        }

        function submitPromo() {
            const input = document.getElementById('promoInput');
            const message = document.getElementById('promoMessage');
            const code = input.value.trim();

            if (code === '67') {
                if (gameState.usedPromoCodes.includes('67')) {
                    message.textContent = '–£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!';
                    message.className = 'promo-message error';
                } else {
                    gameState.ownedSkins.push('skin67');
                    gameState.usedPromoCodes.push('67');
                    gameState.currentSkin = 'skin67';
                    saveState();
                    message.textContent = '–°–∫–∏–Ω 67 –ø–æ–ª—É—á–µ–Ω!';
                    message.className = 'promo-message success';
                }
            } else if (code === '–∞–¥–º–∏–Ω4444') {
                if (gameState.usedPromoCodes.includes('–∞–¥–º–∏–Ω4444')) {
                    message.textContent = '–£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!';
                    message.className = 'promo-message error';
                } else {
                    // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ 4 –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Å–∫–∏–Ω–∞
                    const adminSkins = ['pavel', 'daniel', 'teo', 'papa'];
                    adminSkins.forEach(skinId => {
                        if (!gameState.ownedSkins.includes(skinId)) {
                            gameState.ownedSkins.push(skinId);
                        }
                    });
                    gameState.usedPromoCodes.push('–∞–¥–º–∏–Ω4444');
                    gameState.currentSkin = 'pavel';
                    saveState();
                    message.textContent = '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã: –ü–∞–≤–µ–ª, –î–∞–Ω–∏—ç–ª—å, –¢–µ–æ, –ü–∞–ø–∞!';
                    message.className = 'promo-message success';
                }
            } else {
                message.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!';
                message.className = 'promo-message error';
            }
        }

        // –ò–≥—Ä–∞
        function startGame() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('onlineMenu').classList.add('hidden');
            document.getElementById('gameOver').classList.add('hidden');
            document.getElementById('jumpZone').style.display = 'block';

            currentDiff = DIFFICULTIES[gameState.difficulty];
            player = { x: 80, y: 300, velocity: 0, width: 40, height: 40 };
            pipes = [];
            score = 0;
            frameCount = 0;
            gameRunning = true;

            if (animationId) cancelAnimationFrame(animationId);
            gameLoop();
        }

        function gameLoop() {
            if (!gameRunning) return;
            update();
            render();
            animationId = requestAnimationFrame(gameLoop);
        }

        function update() {
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —á–∏—Ç—ã slowMo –∏ flyMode
            const gravityMod = cheats.flyMode ? 0 : (cheats.slowMo ? 0.5 : 1);
            const speedMod = cheats.freezePipes ? 0 : (cheats.slowMo ? 0.5 : 1);

            // flyMode: –ø–ª–∞–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏
            if (cheats.flyMode) {
                player.velocity *= 0.95; // –ø–ª–∞–≤–Ω–æ–µ —Ç–æ—Ä–º–æ–∂–µ–Ω–∏–µ
            } else {
                player.velocity += currentDiff.gravity * gravityMod;
            }
            player.y += player.velocity;

            // miniSize: —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∏–≥—Ä–æ–∫–∞
            player.width = cheats.miniSize ? 20 : 40;
            player.height = cheats.miniSize ? 20 : 40;

            if (player.y < 0) { player.y = 0; player.velocity = 0; }
            // godMode: –Ω–µ —É–º–∏—Ä–∞–µ–º –æ—Ç –ø–æ–ª–∞
            if (player.y + player.height > canvas.height) {
                if (cheats.godMode) {
                    player.y = canvas.height - player.height;
                    player.velocity = 0;
                } else {
                    gameOver();
                    return;
                }
            }

            frameCount++;
            // noPipes: –Ω–µ —Å–ø–∞–≤–Ω–∏–º —Ç—Ä—É–±—ã
            if (!cheats.noPipes && frameCount % currentDiff.spawn === 0) {
                // wideGap: —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –ø—Ä–æ—Ö–æ–¥
                const gapSize = cheats.wideGap ? currentDiff.gap + 100 : currentDiff.gap;
                const gapY = Math.random() * (canvas.height - gapSize - 150) + 75;
                pipes.push({ x: canvas.width, gapY: gapY, passed: false });
            }

            const PIPE_WIDTH = 60;
            for (let i = pipes.length - 1; i >= 0; i--) {
                pipes[i].x -= currentDiff.pipeSpeed * speedMod;
                if (pipes[i].x + PIPE_WIDTH < 0) { pipes.splice(i, 1); continue; }
                if (!pipes[i].passed && pipes[i].x + PIPE_WIDTH < player.x) {
                    pipes[i].passed = true;
                    // doubleScore: –¥–≤–æ–π–Ω—ã–µ –æ—á–∫–∏
                    score += cheats.doubleScore ? 2 : 1;
                }

                // autoJump: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä—ã–∂–æ–∫ –∫–æ–≥–¥–∞ –ø—Ä–∏–±–ª–∏–∂–∞–µ–º—Å—è –∫ —Ç—Ä—É–±–µ
                if (cheats.autoJump && !isOnlineMode) {
                    const gapSize = cheats.wideGap ? currentDiff.gap + 100 : currentDiff.gap;
                    const pipeCenter = pipes[i].gapY + gapSize / 2;
                    if (pipes[i].x > player.x && pipes[i].x < player.x + 150) {
                        if (player.y > pipeCenter) {
                            jump();
                        }
                    }
                }

                // godMode: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ
                if (!cheats.godMode && checkCollision(pipes[i])) {
                    gameOver();
                    return;
                }
            }
        }

        function checkCollision(pipe) {
            const PIPE_WIDTH = 60;
            const gapSize = cheats.wideGap ? currentDiff.gap + 100 : currentDiff.gap;
            const pL = player.x + 5, pR = player.x + player.width - 5;
            const pT = player.y + 5, pB = player.y + player.height - 5;
            if (pR > pipe.x && pL < pipe.x + PIPE_WIDTH) {
                if (pT < pipe.gapY || pB > pipe.gapY + gapSize) return true;
            }
            return false;
        }

        function render() {
            const PIPE_WIDTH = 60;

            // rainbowMode: —Ä–∞–¥—É–∂–Ω—ã–π —Ñ–æ–Ω
            if (cheats.rainbowMode) {
                const hue = (frameCount * 2) % 360;
                ctx.fillStyle = `hsl(${hue}, 70%, 60%)`;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            } else {
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(1, '#98D8C8');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            ctx.beginPath();
            ctx.arc(100 - (frameCount * 0.5) % 550, 80, 30, 0, Math.PI * 2);
            ctx.arc(130 - (frameCount * 0.5) % 550, 70, 25, 0, Math.PI * 2);
            ctx.fill();

            const gapSize = cheats.wideGap ? currentDiff.gap + 100 : currentDiff.gap;
            // invisPipes: –Ω–µ–≤–∏–¥–∏–º—ã–µ —Ç—Ä—É–±—ã (–ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ)
            const pipeAlpha = cheats.invisPipes ? 0.15 : 1;
            pipes.forEach((pipe, idx) => {
                // rainbowMode: —Ä–∞–¥—É–∂–Ω—ã–µ —Ç—Ä—É–±—ã
                if (cheats.rainbowMode) {
                    const pipeHue = (frameCount * 3 + idx * 50) % 360;
                    ctx.fillStyle = `hsla(${pipeHue}, 80%, 50%, ${pipeAlpha})`;
                } else {
                    ctx.fillStyle = `rgba(46, 204, 113, ${pipeAlpha})`;
                }
                ctx.fillRect(pipe.x, 0, PIPE_WIDTH, pipe.gapY);
                if (cheats.rainbowMode) {
                    const pipeHue = (frameCount * 3 + idx * 50 + 30) % 360;
                    ctx.fillStyle = `hsla(${pipeHue}, 80%, 40%, ${pipeAlpha})`;
                } else {
                    ctx.fillStyle = `rgba(39, 174, 96, ${pipeAlpha})`;
                }
                ctx.fillRect(pipe.x - 5, pipe.gapY - 25, PIPE_WIDTH + 10, 25);
                if (cheats.rainbowMode) {
                    const pipeHue = (frameCount * 3 + idx * 50) % 360;
                    ctx.fillStyle = `hsla(${pipeHue}, 80%, 50%, ${pipeAlpha})`;
                } else {
                    ctx.fillStyle = `rgba(46, 204, 113, ${pipeAlpha})`;
                }
                ctx.fillRect(pipe.x, pipe.gapY + gapSize, PIPE_WIDTH, canvas.height - pipe.gapY - gapSize);
                if (cheats.rainbowMode) {
                    const pipeHue = (frameCount * 3 + idx * 50 + 30) % 360;
                    ctx.fillStyle = `hsla(${pipeHue}, 80%, 40%, ${pipeAlpha})`;
                } else {
                    ctx.fillStyle = `rgba(39, 174, 96, ${pipeAlpha})`;
                }
                ctx.fillRect(pipe.x - 5, pipe.gapY + gapSize, PIPE_WIDTH + 10, 25);
            });

            const currentSkinData = SKINS.find(s => s.id === gameState.currentSkin);
            if (currentSkinData && currentSkinData.draw) {
                currentSkinData.draw(ctx, player.x, player.y, player.width);
            }

            ctx.fillStyle = 'white';
            ctx.font = 'bold 48px Arial';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            ctx.textAlign = 'center';
            ctx.strokeText(score, canvas.width / 2, 70);
            ctx.fillText(score, canvas.width / 2, 70);

            if (isOnlineMode) {
                ctx.fillStyle = '#e91e63';
                ctx.font = 'bold 16px Arial';
                ctx.fillText('ONLINE', canvas.width / 2, 100);
            }

            // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —á–∏—Ç–æ–≤
            const activeCheats = Object.entries(cheats).filter(([k, v]) => v).map(([k]) => k);
            if (activeCheats.length > 0 && !isOnlineMode) {
                ctx.fillStyle = 'rgba(255, 0, 0, 0.7)';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('CHEATS: ON', 10, 25);
                ctx.font = '10px Arial';
                const cheatLabels = {
                    godMode: 'GOD',
                    autoJump: 'AUTO',
                    slowMo: 'SLOW',
                    megaJump: 'MEGA',
                    wideGap: 'WIDE',
                    invisPipes: 'INVIS',
                    miniSize: 'MINI',
                    freezePipes: 'FREEZE',
                    flyMode: 'FLY',
                    doubleScore: 'x2',
                    rainbowMode: 'RGB',
                    noPipes: 'NOPIPE'
                };
                const labels = activeCheats.map(c => cheatLabels[c] || c).join(' ');
                ctx.fillText(labels, 10, 40);
                ctx.textAlign = 'center';
            }
        }

        function jump() {
            if (!gameRunning) return;
            // megaJump: —É—Å–∏–ª–µ–Ω–Ω—ã–π –ø—Ä—ã–∂–æ–∫ (x1.5)
            const jumpPower = cheats.megaJump ? currentDiff.jump * 1.5 : currentDiff.jump;
            player.velocity = jumpPower;
        }

        function gameOver() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            document.getElementById('jumpZone').style.display = 'none';

            const earnedPoints = score;
            gameState.totalScore += earnedPoints;

            if (score > gameState.bestScore) {
                gameState.bestScore = score;
                updateOnlinePresence();
            }

            saveState();

            if (isOnlineMode && db && playerName) {
                db.ref('chat').push({
                    system: true,
                    text: `${playerName} –Ω–∞–±—Ä–∞–ª ${score} –æ—á–∫–æ–≤!`,
                    time: Date.now()
                });
            }

            document.getElementById('finalScore').textContent = score;
            document.getElementById('bestScore').textContent = gameState.bestScore;
            document.getElementById('earnedPoints').textContent = earnedPoints;
            document.getElementById('gameOver').classList.remove('hidden');
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'ArrowUp') { e.preventDefault(); jump(); }
        });

        document.getElementById('jumpZone').addEventListener('click', (e) => { e.preventDefault(); jump(); });
        document.getElementById('jumpZone').addEventListener('touchstart', (e) => { e.preventDefault(); jump(); }, { passive: false });

        document.getElementById('promoInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') submitPromo(); });
        document.getElementById('chatInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') sendChatMessage(); });

        document.addEventListener('gesturestart', (e) => e.preventDefault());
        document.addEventListener('gesturechange', (e) => e.preventDefault());

        document.getElementById('jumpZone').style.display = 'none';
        updateUI();
    </script>
</body>
</html>
